@{
    ViewBag.Title = "主页";
}

@section Head
{

    <script type="text/javascript">
        //treenode节点单机事件
        function nodeClick(node) {
            openMenu(node.text, node.attributes.Width, node.attributes.Height, node.attributes.URL, node.attributes.PicUrl, node.attributes.OpenType);
        }
        //增加导航项
        function addModule(module, i) {
            //var url = "url:'/Api/Menu/GetSubMenusByPMenu?id=" + menu.ID + '&modulecode=' + menu.Module.Code+'"';
            $('#Mainguid').accordion('add', {
                title: module.Name,
                content: '<ul class="easyui-tree" id="tt' + i + '" data-options="url:' + "'" + '/Api/Menu/GetMenusByModule?id=null&modulecode=' + module.Code + "'" + ",method:'get',onClick:nodeClick" + '"></ul>',
                animate: true,
                iconCls: module.PicUrl
            });
        }
        function addTab(title, href,icon){  
            var tt = $('#content');
            if (tt.tabs('exists', title)){//如果tab已经存在,则选中并刷新该tab          
                tt.tabs('select', title);  
                refreshTab({tabTitle:title,url:href});  
            } else {
                var content;
                if (href){  
                     content = '<iframe scrolling="no" frameborder="0"  src="'+href+'" style="width:100%;height:100%;"></iframe>';  
                } else {  
                     content = '未实现';  
                }  
                tt.tabs('add',{  
                    title:title,  
                    closable:true,  
                    content:content,  
                    iconCls:icon||'icon-default'  
                });  
            }  
        }  
       /**     
        * 刷新tab 
        *example: {tabTitle:'tabTitle',url:'refreshUrl'} 
        *如果tabTitle为空，则默认刷新当前选中的tab 
        *如果url为空，则默认以原来的url进行reload 
        */  
        function refreshTab(cfg){  
            var refresh_tab = cfg.tabTitle ? $('#content').tabs('getTab', cfg.tabTitle) : $('#content').tabs('getSelected');
            if(refresh_tab && refresh_tab.find('iframe').length > 0){  
                var _refresh_ifram = refresh_tab.find('iframe')[0];  
                var refresh_url = cfg.url?cfg.url:_refresh_ifram.src;  
                //_refresh_ifram.src = refresh_url;  
                _refresh_ifram.contentWindow.location.href=refresh_url;  
            }  
        }  
        //增加tab内容页
        function openMenu(title, width, height, url, opentype, icon, params) {

            switch (parseInt(opentype)) {
            case 1: //弹窗(模态)
                $('#win').window({
                    title: title,
                    width: width,
                    height: height,
                    border: false,
                    closed: false,
                    cache: false,
                    href: url,
                    modal: true
                });
                break;
            case 2: //弹窗（非模态）    
                $('#win').window({
                    title: title,
                    width: width,
                    height: height,
                    closed: false,
                    border: false,
                    cache: false,
                    href: url,
                    modal: false
                });
                break;
            default:
                addTab(title, url, icon);
            }
        }

        $(function() {
            $.ajax({
                url: "/api/Module/",
                type: "Get",
                dataType: 'json',
                success: function(modules) {
                    for (var i = 0; i < modules.length; i++) {
                        addModule(modules[i], i);
                    }
                }
            });
        });
    </script>
}
<div class="easyui-layout" data-options="fit:true">
    @*标题*@
    <div data-options="region:'north'" style="height: 100px;">
    </div>

    @*导航*@
    <div data-options="region:'west',title:'导航菜单',split:true" style="width: 200px;">
        <div id="Mainguid" class="easyui-accordion" data-options="fit:true,border:false" style="width: 300px;">
        </div>
    </div>

    @*内容*@
    <div data-options="region:'center',border:false" style="padding: 0px">
        <div id="content" class="easyui-tabs" data-options="fit:true">
        </div>
    </div>
    
    @*用于弹窗*@
    <div id="win"></div>  
    

</div>
